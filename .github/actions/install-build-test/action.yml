name: install-build-test
description: ""

inputs:
  target:
    description: Build target.
    required: true

runs:
  using: composite
  steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6.0.1
      with:
        submodules: recursive

    - name: Install rust
      run: |
        rustup default stable
        rustup component add rustfmt
        rustup target add ${{ inputs.target }}
      shell: bash

    - name: Build
      run: |
        cargo build --target ${{ inputs.target }}
      shell: bash

    - name: Test
      run: |
        cargo test --target ${{ inputs.target }} -- --nocapture --test-threads 1
      shell: bash
